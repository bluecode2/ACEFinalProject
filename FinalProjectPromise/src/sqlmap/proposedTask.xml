<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="proposedTask">

	<select id="getNewProposedTaskId">
		select MAX(PROPOSED_TASK_ID)+1 FROM VPROPOSED_TASK
	</select>
	
	<select id="getListProposedTask" parameterClass="java.util.Map" 
		resultClass="proposed_task.ProposedTaskBean">
		SELECT * FROM ( 
		SELECT protask.*, ROWNUM rnum from ( 
		SELECT 
		proposed_task_id 	as propTaskId,
		proposed_task_name 	as propTaskName,
		proposed_task_desc 	as propTaskDesc,
		est_start_date		as estStartDate,
		est_end_date 		as estEndDate,
		proposed_by 		as propBy,
		proposed_by_name	as propByName,
		proposed_to			as propTo,
		proposed_to_name	as propToName,
		created_by 			as createdBy,
		updated_by	 		as updatedBy,
		create_date 		as createDate,
		update_date 		as updateDate,
		task_id		 		as taskId,
		proposal_status		as propStatus,
		proposal_status_name as propStatusName
		FROM VPROPOSED_TASK
		WHERE proposed_by = #userId# and proposal_status != 'TA_STAT_99'
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskName">
				LOWER(proposed_task_name) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propToName">
				LOWER(proposed_to_name) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>		
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propStatusName">
				LOWER(proposal_status_name) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		order by proposed_task_id
		) protask where ROWNUM &lt; = #end#) WHERE rnum &gt;
		#begin#
	</select>
	
	<select id="getPropTaskByPropTaskId" parameterClass="java.lang.Integer"
		resultClass="proposed_task.ProposedTaskBean">
		SELECT 
		proposed_task_id 	as propTaskId,
		proposed_task_name 	as propTaskName,
		proposed_task_desc 	as propTaskDesc,
		est_start_date		as estStartDate,
		est_end_date 		as estEndDate,
		proposed_by 		as propBy,
		proposed_by_name	as propByName,
		proposed_to			as propTo,
		proposed_to_name	as propToName,
		created_by 			as createdBy,
		updated_by	 		as updatedBy,
		create_date 		as createDate,
		update_date 		as updateDate,
		task_id		 		as taskId,
		proposal_status		as propStatus,
		proposal_status_name as propStatusName
		FROM VPROPOSED_TASK
		WHERE proposed_task_id = #propTaskId#
	</select>
	
	<select id="countProposedTask" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT COUNT(1) FROM vproposed_task
		WHERE proposed_by = #userId# and proposal_status != 'TA_STAT_99'
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskId">
				LOWER(proposed_task_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskName">
				LOWER(proposed_task_name)
				LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
	</select>
	
<!-- 	<insert id="insertGeneralHoliday" parameterClass="holiday.GeneralHolidayBean"> -->
<!-- 		insert into -->
<!-- 		GENERAL_HOLIDAY(GEN_HOLIDAY_ID, GEN_HOLIDAY_NAME, GEN_HOLIDAY_DATE, -->
<!-- 		IS_GENERATED, created_by, updated_by, create_date, update_date) -->
<!-- 		values -->
<!-- 		(#genHolidayId#, #genHolidayName#, -->
<!-- 		TO_DATE(#genHolidayDateInString#,'yyyy-MM-dd'), 0, #createdBy#, NULL, -->
<!-- 		SYSDATE, NULL) -->
<!-- 	</insert> -->
	
<!-- 	<select id="getGeneralHolidayEdit" resultClass="holiday.GeneralHolidayBean"> -->
<!-- 		SELECT -->
<!-- 		GEN_HOLIDAY_ID as genHolidayId, -->
<!-- 		GEN_HOLIDAY_NAME as genHolidayName, -->
<!-- 		GEN_HOLIDAY_DATE as genHolidayDateInString, -->
<!-- 		IS_GENERATED as isGenerated -->
<!-- 		FROM GENERAL_HOLIDAY -->
<!-- 		where GEN_HOLIDAY_ID = #value# -->
<!-- 		ORDER BY -->
<!-- 		GEN_HOLIDAY_ID -->
<!-- 	</select> -->

<!-- 	<update id="editGeneralHoliday" parameterClass="holiday.GeneralHolidayBean"> -->
<!-- 		UPDATE GENERAL_HOLIDAY -->
<!-- 		SET -->
<!-- 		GEN_HOLIDAY_NAME=#genHolidayName#, -->
<!-- 		GEN_HOLIDAY_DATE=to_date(#genHolidayDateInString#,'yyyy-MM-dd'), -->
<!-- 		IS_GENERATED=#isGenerated#, -->
<!-- 		updated_by=#updatedBy#, -->
<!-- 		update_date=SYSDATE -->
<!-- 		WHERE -->
<!-- 		GEN_HOLIDAY_ID=#genHolidayId# -->
<!-- 	</update> -->

 	<update id="deleteProposedTask" parameterClass="java.util.Map">
 		update
 		PROPOSED_TASK
 		set proposal_status = 'TA_STAT_99',
 		updated_by = #userId#,
 		update_date = SYSDATE
 		WHERE proposed_task_id=#propTaskId#
 	</update>

</sqlMap>