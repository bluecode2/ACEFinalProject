<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="employee">
	<select id="getMaxEmployeeId" resultClass="employee.EmployeeBean">
		SELECT
		MAX(EMPLOYEE_ID)+1 FROM EMPLOYEE
	</select>

	<select id="getAllEmployee" resultClass="employee.EmployeeBean"
		parameterClass="java.util.Map">
		SELECT * FROM(
		SELECT emp.*, ROWNUM rnum from (
		SELECT
		EMPLOYEE_ID 						AS employeeId,
		EMPLOYEE_code 						AS employeeCode,
		DEPT_ID 							AS deptId,
		DEPT_CODE 							AS deptCode,
		DEPT_NAME							AS deptName,
		RANK_ID 							AS rankId,
		RANK_CODE 							AS rankCode,
		RANK_NAME 							AS rankName,
		SUPERVISOR_ID 						AS supervisorID,
		SUPERVISOR_CODE 					AS supervisorCode,
		SUPERVISOR_NAME 					AS supervisorName,
		CREATED_BY 							AS createdBy,
		UPDATED_BY 							AS updatedBy,
		EMPLOYEE_NAME 						AS employeeName,
		GENDER 								AS gender,
		EMAIL 								AS email,
		ADDRESS 							AS address,
		PHONE_NUMBER 						AS phoneNumber,
		is_active							AS isActive,
		TO_CHAR(CREATE_DATE,'YYYY-MM-DD') 	AS createDateInString,
		TO_CHAR(UPDATE_DATE,'YYYY-MM-DD') 	AS updateDateInString
		FROM vEMPLOYEE
		where is_Active = 1
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="employeeCode">
				LOWER(EMPLOYEE_code) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="deptId">
				LOWER(dept_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>		
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="rankId">
				LOWER(rank_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="supervisorId">
				LOWER(SUPERVISOR_ID) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>									
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="employeeName">
				LOWER(EMPLOYEE_NAME) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>								
		ORDER BY EMPLOYEE_ID ASC ) emp where ROWNUM &lt; = #end#)
		WHERE rnum
		&gt;
		#begin#
	</select>
	
	<select id="getEmployeeByEmpId" parameterClass="java.lang.Integer" resultClass="employee.EmployeeBean">
	SELECT
		EMPLOYEE_ID 						AS employeeId,
		EMPLOYEE_code 						AS employeeCode,
		EMPLOYEE_NAME 						AS employeeName,
		EMAIL 								AS email,
		ADDRESS 							AS address,
		PHONE_NUMBER 						AS phoneNumber,
		TO_CHAR(CREATE_DATE,'YYYY-MM-DD') 	AS createDateInString,
		TO_CHAR(UPDATE_DATE,'YYYY-MM-DD') 	AS updateDateInString
		FROM EMPLOYEE where employee_id = #value# and IS_ACTIVE = 1
	</select>
	
	<select id="getEmployeeForDeptHead" parameterClass="java.lang.Integer" resultClass="employee.EmployeeBean">
	SELECT
		EMPLOYEE_ID 						AS employeeId,
		EMPLOYEE_code 						AS employeeCode,
		DEPT_ID 							AS deptId,
		e.RANK_ID 							AS rankId,
		EMPLOYEE_NAME 						AS employeeName,
		EMAIL 								AS email
		FROM EMPLOYEE e
		LEFT JOIN rank_emp re ON re.rank_id = e.rank_id
		WHERE dept_id = #value# and IS_ACTIVE = 1 AND re.rank_id = fGetGeneralParameterValue('deptHeadLevel')
	</select>
	
	<select id="getNewEmpId" resultClass="java.lang.Integer">
	select max(employee_id)+1 from employee 
	</select>

	<insert id="insertEmployee" parameterClass="employee.EmployeeBean">
		INSERT INTO EMPLOYEE
		(EMPLOYEE_ID, DEPT_ID, RANK_ID, SUPERVISOR_ID, CREATED_BY,
		UPDATED_BY, EMPLOYEE_NAME,
		GENDER, EMAIL, ADDRESS,
		PHONE_NUMBER,CREATE_DATE,UPDATE_DATE,IS_ACTIVE,EMPLOYEE_CODE)
		VALUES
		(#employeeId#,#deptId#,#rankId#,#supervisorID#,#createdBy#,null,#employeeName#,
		#gender#,#email#,#address#,#phoneNumber#,SYSDATE,null,1,#employeeCode#)
	</insert>

	<update id="updateEmployee" parameterClass="employee.EmployeeBean">
		UPDATE EMPLOYEE SET
		DEPT_ID = #deptId#,
		RANK_ID = #rankId#,
		SUPERVISOR_ID = #supervisorID#,
		UPDATED_BY = #updatedBy#,
		EMPLOYEE_NAME = #employeeName#,
		GENDER = #gender#,
		EMAIL = #email#,
		ADDRESS = #address#,
		PHONE_NUMBER = #phoneNumber#,
		UPDATE_DATE = SYSDATE,
		EMPLOYEE_CODE = #employeeCode#
		WHERE EMPLOYEE_ID = #employeeId#
	</update>

	<delete id="deleteEmployee" parameterClass="java.util.Map">
		update
		employee set
		IS_ACTIVE = 0
		UPDATED_BY = #userName#,
		UPDATE_DATE = SYSDATE
		where EMPLOYEE_ID = #employeeId#
	</delete>

	<select id="countEmployee" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT COUNT(1) FROM EMPLOYEE
		where is_active = 1
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="employeeId">
				LOWER(employee_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="deptId">
				LOWER(dept_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>		
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="rankId">
				LOWER(rank_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="supervisorId">
				LOWER(SUPERVISOR_ID) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>				
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="projectId">
				LOWER(PROJECT_ID) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>						
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="employeeName">
				LOWER(EMPLOYEE_NAME) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>								

	</select>
</sqlMap>
