<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="appPropProjTask">
	
	<select id="getListToApp" parameterClass="java.util.Map" 
		resultClass="proposed_task.ProposedTaskBean">
		SELECT * FROM ( 
		  SELECT protask.*, ROWNUM rnum from ( 
		  SELECT 
		  proposed_task_id  as propTaskId,
		  proposed_task_name  as propTaskName,
		  proposed_task_desc  as propTaskDesc,
		  TO_CHAR(est_start_date,'yyyy-MM-dd') as estStartDateInString,
		  TO_CHAR(est_end_date,'yyyy-MM-dd') as estEndDateInString,
		  proposed_by   as propBy,
		  proposed_by_name as propByName,
		  proposed_to   as propTo,
		  proposed_to_name as propToName,
		  created_by    as createdBy,
		  updated_by    as updatedBy,
		  create_date   as createDate,
		  update_date   as updateDate,
		  task_id     as taskId,
		  proposal_status  as propStatus,
		  proposal_status_name as propStatusName,
		  est_main_days 		as estMainDays,
		  PROJECT_ID AS projectId,
		  PROJECT_NAME AS projectName
		  FROM VPROPOSED_TASK
		WHERE proposal_status = 'TA_STAT_01' AND proposed_to = #empId#
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskName">
				LOWER(proposed_task_name) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propBy">
				LOWER(proposed_by) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>		
		order by proposed_task_id
		) protask where ROWNUM &lt; = #end#) WHERE rnum &gt;
		#begin#
	</select>
	
	<select id="countListToApp" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT COUNT(1) FROM proposed_task
		WHERE proposal_status = 'TA_STAT_01' AND proposed_to = #userId#
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskId">
				LOWER(proposed_task_id) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="propTaskName">
				LOWER(proposed_task_name)
				LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
	</select>
	
</sqlMap>