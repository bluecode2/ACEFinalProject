<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="projectMember">
	<select id="getAllProjMember" resultClass="project_member.ProjectMemberBean" parameterClass="java.util.Map">
		SELECT * from (
			SELECT us.*, ROWNUM rnum from(
		    	SELECT 
		    	MEMBER_ID AS memberId,
		    	PROJECT_ROLE_ID AS projectRoleId,
		    	EMPLOYEE_ID AS employeeId,
		    	PROJECT_ID AS projectId,
		    	PROJECT_CODE AS projCode,
		    	PROJECT_NAME AS projName,
		    	EMPLOYEE_NAME AS empName,
		    	PROJECT_ROLE_NAME AS projRoleName,
		    	PROJECT_ROLE_CODE AS projRoleCode,
		    	TO_CHAR(EST_START_DATE,'yyyy-MM-dd') AS estStartDateInString,
		    	TO_CHAR(EST_END_DATE,'yyyy-MM-dd') AS estEndDateInString
		    	FROM VPROJECTMEMBER
				where PROJECT_ID = #projId#
      	 		order by MEMBER_ID) us 
	       WHERE ROWNUM &lt; = #end#)
        WHERE rnum &gt; #begin#
	</select>
	
	<select id="countProjectMember" resultClass="java.lang.Integer"
		parameterClass="java.lang.Integer">
		SELECT COUNT(1) FROM vprojectMember
		where PROJECT_ID = #projId#
	</select>
	
	<insert id="insertProjectMember" parameterClass="java.util.Map">
		INSERT INTO PROJECT_MEMBER (MEMBER_ID, PROJECT_ROLE_ID, EMPLOYEE_ID, PROJECT_ID) 
		VALUES 
		(#newMemberId#,#pRoleId#,#empId#,#projId#)
	</insert>
	
	<select id="getProjectMemberId" resultClass="java.lang.Integer">
		SELECT MAX(MEMBER_ID)+1 FROM PROJECT_MEMBER
	</select>
	
	<select id="getAllMemberFromProject" resultClass="project_member.ProjectMemberBean" parameterClass="java.lang.Integer">
		select 	MEMBER_ID AS memberId,
		    	PROJECT_ROLE_ID AS projectRoleId,
		    	EMPLOYEE_ID AS employeeId,
		    	PROJECT_ID AS projectId,
		    	PROJECT_CODE AS projCode,
		    	PROJECT_NAME AS projName,
		    	EMPLOYEE_NAME AS empName,
		    	PROJECT_ROLE_NAME AS projRoleName,
		    	PROJECT_ROLE_CODE AS projRoleCode,
		    	TO_CHAR(EST_START_DATE,'yyyy-MM-dd') AS estStartDateInString,
		    	TO_CHAR(EST_END_DATE,'yyyy-MM-dd') AS estEndDateInString
		    	FROM VPROJECTMEMBER		    			
		    	where PROJECT_ID = #projId#
	</select>
</sqlMap>