<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="users">
	<insert id="insertNewUser" parameterClass="user.UserBean">
		INSERT INTO users
		( USER_ID,
		USER_ROLE_ID,
		EMPLOYEE_ID,
		CREATED_BY,
		USERNAME ,
		PASSWORD_USER,
		IS_ACTIVE,
		CREATE_DATE
		)
		VALUES
		( #userId#, #userRoleId#,
		#employeeId#, #createdBy#,
		#username#, dbms_obfuscation_toolkit.md5(input_string= &gt; #passwordUser#),
		1, SYSDATE)
	</insert>

	<select id="getNewUserId" resultClass="java.lang.Integer">
		select max(user_id)+1 from users
	</select>

	<select id="getAllUser" parameterClass="java.util.Map"
		resultClass="user.UserBean">
		Select * from (
		select us.*, ROWNUM rnum from (
		SELECT
		USER_ID AS userId,
		USER_ROLE_ID AS userRoleId,
		EMPLOYEE_ID AS employeeId,
		CREATED_BY AS createdBy,
		UPDATED_BY AS updatedBy,
		USERNAME AS username,
		PASSWORD_USER AS passwordUser,
		IS_ACTIVE as isActive,
		TO_CHAR(CREATE_DATE,'YYYY-MM-DD') as createDateInString,
		TO_CHAR(UPDATE_DATE,'YYYY-MM-DD') as updateDateInString
		FROM USERS
		where Is_active = 1
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.userId">
				<isNotEmpty property="searchValue">
				LOWER(USER_ID)
				LIKE LOWER( '%' || #searchValue# || '%' )
				</isNotEmpty>
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.userRoleId">
			<isNotEmpty property="searchValue">
				LOWER(USER_ROLE_ID) LIKE LOWER( '%' || #searchValue# || '%' )
				</isNotEmpty>
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.employeeId">
			<isNotEmpty property="searchValue">
				LOWER(EMPLOYEE_ID) LIKE LOWER( '%' || #searchValue# || '%' )
				</isNotEmpty>
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.username">
			<isNotEmpty property="searchValue">
				LOWER(USERNAME)
				LIKE LOWER( '%' || #searchValue# || '%' )
				</isNotEmpty>
			</isEqual>
		</dynamic>
		ORDER BY USER_ID ASC ) us 
		where ROWNUM &lt; = #end#) 
		WHERE rnum
		&gt;
		#begin#
	</select>

	<select id="countUser" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT COUNT(1) FROM USERS
		WHERE IS_ACTIVE = 1
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.userId">
				LOWER(USER_ID)
				LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.userRoleId">
				LOWER(USER_ROLE_ID) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.employeeId">
				LOWER(EMPLOYEE_ID) LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
		<dynamic prepend="AND">
			<isEqual property="searchField" compareValue="uBean.username">
				LOWER(USERNAME)
				LIKE LOWER( '%' || #searchValue# || '%' )
			</isEqual>
		</dynamic>
	</select>
	
	<select id="getNewUserID" resultClass="java.lang.Integer">
		SELECT MAX(USER_ID)+1 FROM USERS
	</select>
	
</sqlMap>